<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta name="robots" content="noindex, nofollow">
        <meta charset="UTF-8" />
    <title>Shine Payments ‚Äî Phantom demo (devnet, deep logs)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; padding: 20px; }
    h1 { font-size: 18px; margin-bottom: 12px; }
    .row { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
    button { padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
    button:hover { background: #f5f5f5; }
    #log {
    background: #0a0a0a; color: #d1d5db; padding: 12px; border-radius: 10px;
    min-height: 220px; max-height: 60vh; overflow: auto; line-height: 1.4; white-space: pre-wrap;
    box-shadow: inset 0 0 0 1px #222;
}
    .muted { color: #6b7280; }
    .ok { color: #86efac; }
    .err { color: #fca5a5; }

    /* ‚Äî‚Äî‚Äî banner —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º ‚Äî‚Äî‚Äî */
    .banner {
        display: flex; align-items: center; gap: 14px;
        padding: 12px 14px; margin: 12px 0 18px;
        border: 1px solid #f1e5a8; border-radius: 12px;
        background: #fffbe6; color: #7a5d00;
    }
    .banner img { width: 44px; height: 44px; border-radius: 8px; flex: 0 0 auto; }
    .banner .txt { line-height: 1.35; }
    .banner .txt b { font-weight: 700; }
    .banner .en { margin-top: 6px; color: #6b7280; font-size: 13px; }

</style>
</head>
<body>
<!-- DEV BANNER (logo + RU/EN notice) -->
<div class="banner" role="note" aria-label="Dev notice">
    <img src="./shine_nft_logo_256.png" alt="Shine logo">
    <div class="txt">
        <div><b>–í–ù–ò–ú–ê–ù–ò–ï:</b> —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –Ø —Ä–∞–∑–±–∏—Ä–∞—é—Å—å –∏ –ø–∏—à—É —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ dApp –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∏ —Ç–µ—Å—Ç–∏—Ä—É—é –µ–≥–æ —Ä–∞–±–æ—Ç—É –≤ Devnet –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ Phantom. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–∞–±–æ—á–∏–º –ø—Ä–æ–¥—É–∫—Ç–æ–º –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ç–µ—Å—Ç–æ–≤.</div>
        <div class="en"><b>NOTICE:</b> this is a development test page. I‚Äôm building a smart contract and dApp for a future token and testing it on Devnet and Phantom wallet connection. This page is not a live product and is intended for internal testing only.</div>
    </div>
</div>

<h1>Shine Payments ‚Äî Phantom wallet (devnet)</h1>

<div class="row">
    <button id="btnConnect">Connect Phantom</button>
    <button id="btnInfo"    disabled>–ü–æ–∫–∞–∑–∞—Ç—å –∞–¥—Ä–µ—Å –∏ –±–∞–ª–∞–Ω—Å</button>
    <button id="btnAirdrop" disabled>Airdrop 1 SOL (devnet)</button>
    <button id="btnInit"    disabled>–í—ã–ø–æ–ª–Ω–∏—Ç—å init()</button>
    <button id="btn-delete-init"  disabled>üóëÔ∏è –£–¥–∞–ª–∏—Ç—å PDA (delete_init)</button>
</div>

<div class="muted">
    –í Phantom –≤—ã–±–µ—Ä–∏ —Å–µ—Ç—å <b>Devnet</b>. –õ–æ–≥–∏ –Ω–∏–∂–µ –∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12 ‚Üí Console).
</div>

<pre id="log"></pre>

<!-- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: web3.js -->
<script src="https://unpkg.com/@solana/web3.js@1.95.0/lib/index.iife.min.js"></script>
<script>
    (async () => {
    const logEl = document.getElementById("log");
    const autoScroll = () => { logEl.scrollTop = logEl.scrollHeight; };
    const log = (...a) => { console.log(...a); logEl.textContent += a.join(" ") + "\n"; autoScroll(); };
    const logOk  = (...a) => log('%c' + a.join(" "), 'color:#86efac');
    const logErr = (...a) => log('%c' + a.join(" "), 'color:#fca5a5');

    // ===== –ü–ê–†–ê–ú–ï–¢–†–´ –ü–†–û–ï–ö–¢–ê =====
    const RPC_URL    = "https://api.devnet.solana.com";
    const PROGRAM_ID = new solanaWeb3.PublicKey("92sgkgx7KHpbhQu81mNGHaKa7skJB7esArVdPM7paDSW");
    const STATE_SEED = "shine_investments_state";

    // –õ—É—á—à–µ "processed" –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–π + "confirmed" –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π
    const connection = new solanaWeb3.Connection(RPC_URL, { commitment: "confirmed" });
    const enc = new TextEncoder();

    let provider = null;       // Phantom provider (window.solana)
    let walletPubkey = null;   // PublicKey –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Phantom
    let logsSubId = null;      // id –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã

    // ===== –£–¢–ò–õ–ò–¢–´ –û–®–ò–ë–û–ö/–õ–û–ì–û–í =====
    function safeJson(v) {
    try { return JSON.stringify(v, null, 2); } catch { return String(v); }
}

    function printRpcError(prefix, e) {
    // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—à–∏–±–æ–∫ Solana/Anchor —á–∞—Å—Ç–æ –ª–µ–∂–∏—Ç –≤ e, e.message, e.data, e.logs, e.code
    logErr(prefix);
    if (!e) return;

    if (e.message) logErr("message:", e.message);
    if (e.code !== undefined) logErr("code:", e.code);
    if (e.name) logErr("name:", e.name);

    // web3.js/JSON-RPC –∏–Ω–æ–≥–¥–∞ –∫–ª–∞–¥—ë—Ç —ç—Ç–æ —Å—é–¥–∞:
    if (e.data) {
    if (e.data.logs) {
    logErr("logs:");
    (e.data.logs || []).forEach(l => logErr("  " + l));
}
    if (e.data.err) {
    logErr("rpc err:", safeJson(e.data.err));
}
}

    // –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ—à–µ–ª—å–∫–∏/–æ–±—ë—Ä—Ç–∫–∏ –∫–ª–∞–¥—É—Ç –ª–æ–≥–∏ –ø—Ä—è–º–æ –≤ e.logs
    if (e.logs) {
    logErr("logs:");
    (e.logs || []).forEach(l => logErr("  " + l));
}

    // –°—Ç–µ–∫ ‚Äî –≤ –∫–æ–Ω—Ü–µ
    if (e.stack) {
    logErr("stack:\n" + e.stack);
}
}

    async function simulateAndLog(tx) {
    // –°–∏–º—É–ª—è—Ü–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π ‚Äî –∫–ª—é—á –∫ –ø–æ–Ω–∏–º–∞–Ω–∏—é, –≥–¥–µ –ø–∞–¥–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.
    try {
    const sim = await connection.simulateTransaction(tx, {
    sigVerify: false,           // –ø–æ–¥–ø–∏—Å—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
    commitment: "processed"
});
    const v = sim.value;
    log("üîé simulate result ‚Äî err:", safeJson(v.err));
    if (v.logs?.length) {
    log("ü™µ simulate logs:");
    v.logs.forEach(l => log("  " + l));
}
    if (v.unitsConsumed !== undefined) {
    log("‚õΩ compute units (simulate):", v.unitsConsumed);
}
    return v;
} catch (e) {
    printRpcError("‚ùå –û—à–∏–±–∫–∞ simulateTransaction:", e);
    return null;
}
}

    async function confirmAndLog(signature, blockhashCtx) {
    try {
    const { blockhash, lastValidBlockHeight } = blockhashCtx;
    log("üß± confirm with blockhash/lastValid:", blockhash, "/", lastValidBlockHeight);
    const res = await connection.confirmTransaction(
{ signature, blockhash, lastValidBlockHeight },
    "confirmed"
    );
    log("üì¨ confirmation status:", safeJson(res.value));
    return res.value;
} catch (e) {
    printRpcError("‚ùå –û—à–∏–±–∫–∞ confirmTransaction:", e);
    return null;
}
}

    async function getSigStatus(signature) {
    try {
    const st = await connection.getSignatureStatus(signature, { searchTransactionHistory: true });
    log("üßæ signature status:", safeJson(st?.value));
    return st?.value;
} catch (e) {
    printRpcError("‚ùå –û—à–∏–±–∫–∞ getSignatureStatus:", e);
}
}

    // ===== Anchor discriminator (8 –±–∞–π—Ç) =====
    async function anchorDiscriminator8(name) {
    const hash = await crypto.subtle.digest("SHA-256", enc.encode("global:" + name));
    return new Uint8Array(hash).slice(0, 8);
}

    // ===== PDA =====
    async function getStatePda() {
    const [pda] = await solanaWeb3.PublicKey.findProgramAddress(
    [enc.encode(STATE_SEED)],
    PROGRAM_ID
    );
    return pda;
}

    // ===== –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Phantom —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º =====
    async function sendViaPhantom(tx, blockhashCtx) {
        // –í–∞—Ä–∏–∞–Ω—Ç —Å signAndSendTransaction –≤–µ—Ä–Ω—ë—Ç —Å—Ä–∞–∑—É signature,
        // –Ω–æ –∏–Ω–æ–≥–¥–∞ —Ç–µ—Ä—è—é—Ç—Å—è preflight-–¥–µ—Ç–∞–ª–∏. –ú—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ª–æ–≥–∏—Ä—É–µ–º simulate.
        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ: —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –±–µ–∑ –ø–æ–¥–ø–∏—Å–µ–π, –º–µ—Å—Ç–æ –ø–æ–¥ Lighthouse-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
        await simulateAndLog(tx); // –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å, –ø–æ–¥–ø–∏—Å—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
        if (!provider.signAndSendTransaction) throw new Error("Phantom –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç signAndSendTransaction");
        const {signature} = await provider.signAndSendTransaction(tx);
        logOk("‚úçÔ∏è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, —Å–∏–≥–Ω–∞—Ç—É—Ä–∞:", signature);
        await confirmAndLog(signature, blockhashCtx);
        await getSigStatus(signature);
        return signature;

    }

    function setButtonsEnabled(connected) {
    document.getElementById("btnInfo").disabled    = !connected;
    document.getElementById("btnAirdrop").disabled = !connected;
    document.getElementById("btnInit").disabled    = !connected;
    document.getElementById("btn-delete-init").disabled = !connected;
}

    // ===== CONNECT =====
    document.getElementById("btnConnect").addEventListener("click", async () => {
    try {
    if (!window.solana || !window.solana.isPhantom) {
    logErr("‚ùå Phantom –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ Phantom Wallet.");
    return;
}
    provider = window.solana;

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –¢–û–õ–¨–ö–û –ø–æ –∫–ª–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
    log("üîå –û–∂–∏–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Phantom‚Ä¶");
    await provider.connect(); // –±–µ–∑ onlyIfTrusted ‚Äî —ç—Ç–æ —É–∂–µ —è–≤–Ω—ã–π –∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    walletPubkey = provider.publicKey;
    logOk("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ:", walletPubkey.toBase58());
    setButtonsEnabled(true);

    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç —É–≤–∏–¥–µ—Ç—å —Ç–æ, —á—Ç–æ –≤ simulate/confirm –º–æ–≥–ª–æ –Ω–µ –ø–æ–ø–∞—Å—Ç—å
    try {
    if (logsSubId) {
    await connection.removeOnLogsListener(logsSubId);
    logsSubId = null;
}
    logsSubId = connection.onLogs(PROGRAM_ID, (ev) => {
    log("üõ∞ onLogs:", ev.signature, "err:", safeJson(ev.err));
    (ev.logs || []).forEach(l => log("  " + l));
}, "confirmed");
    log("üì° –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤–∫–ª—é—á–µ–Ω–∞.");
} catch (e) {
    printRpcError("‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã:", e);
}

    provider.on?.("disconnect", async () => {
    log("üîå –û—Ç–∫–ª—é—á–µ–Ω–æ");
    setButtonsEnabled(false);
    walletPubkey = null;
    if (logsSubId) {
    try { await connection.removeOnLogsListener(logsSubId); } catch {}
    logsSubId = null;
}
});
} catch (e) {
    printRpcError("‚ùå Connect error:", e);
}
});

    // ===== INFO =====
    document.getElementById("btnInfo").addEventListener("click", async () => {
    try {
    if (!walletPubkey) throw new Error("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏ Phantom.");
    const balanceLamports = await connection.getBalance(walletPubkey, "processed");
    const statePda = await getStatePda();
    log("üëõ –ö–æ—à–µ–ª—ë–∫:", walletPubkey.toBase58());
    log("üí∞ –ë–∞–ª–∞–Ω—Å:", balanceLamports / solanaWeb3.LAMPORTS_PER_SOL, "SOL");
    log("üì¶ statePda:", statePda.toBase58());
    log("üåê RPC:", RPC_URL);
} catch (e) {
    printRpcError("‚ùå –û—à–∏–±–∫–∞ INFO:", e);
}
});

    // ===== AIRDROP (devnet) =====
    document.getElementById("btnAirdrop").addEventListener("click", async () => {
    try {
    if (!walletPubkey) throw new Error("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏ Phantom.");
    log("‚õΩ –ó–∞–ø—Ä–æ—Å airdrop 1 SOL –Ω–∞", walletPubkey.toBase58());
    const sig = await connection.requestAirdrop(walletPubkey, 1 * solanaWeb3.LAMPORTS_PER_SOL);
    log("‚è≥ confirm airdrop‚Ä¶");
    const { value: ctx } = await connection.getLatestBlockhashAndContext("processed");
    await confirmAndLog(sig, ctx);
    logOk("‚úÖ Airdrop tx:", sig);
    const bal = await connection.getBalance(walletPubkey);
    log("üí∞ –ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:", bal / solanaWeb3.LAMPORTS_PER_SOL, "SOL");
} catch (e) {
    printRpcError("‚ùå –û—à–∏–±–∫–∞ airdrop:", e);
}
});

    // ===== INIT() =====
    document.getElementById("btnInit").addEventListener("click", async () => {
    try {
    if (!walletPubkey) throw new Error("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏ Phantom.");

    const statePda = await getStatePda();
    log("üöÄ –í—ã–∑—ã–≤–∞–µ–º init()");
    log("   payer:    ", walletPubkey.toBase58());
    log("   statePda: ", statePda.toBase58());
    log("   programId:", PROGRAM_ID.toBase58());

    // 8 –±–∞–π—Ç –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–æ—Ä–∞ Anchor –¥–ª—è "global:init"
    const data = await anchorDiscriminator8("init"); // Uint8Array –¥–ª–∏–Ω–æ–π 8

    // –ê–∫–∫–∞—É–Ω—Ç—ã –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç on-chain –º–µ—Ç–æ–¥
    const keys = [
{ pubkey: walletPubkey,                     isSigner: true,  isWritable: true  }, // payer (signer)
{ pubkey: statePda,                         isSigner: false, isWritable: true  }, // state PDA
{ pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
    ];

    const ix = new solanaWeb3.TransactionInstruction({ programId: PROGRAM_ID, keys, data });

    // –ü–æ–ª—É—á–∞–µ–º –±–ª–æ–∫—Ö–µ—à/lastValidBlockHeight –∏ –ª–æ–≥–∏—Ä—É–µ–º
    const { value: ctx } = await connection.getLatestBlockhashAndContext("processed");
    const { blockhash, lastValidBlockHeight } = ctx;
    log("‚è± blockhash:", blockhash);
    log("‚è± lastValidBlockHeight:", lastValidBlockHeight);

    const tx = new solanaWeb3.Transaction({
    feePayer: walletPubkey,
    recentBlockhash: blockhash,
}).add(ix);

    // 1) –°–∏–º—É–ª—è—Ü–∏—è ‚Äî —Å—Ä–∞–∑—É –ø–æ–∫–∞–∂–µ—Ç –ª–æ–≥–∏ Anchor/InstructionError
    await simulateAndLog(tx);

    log("üìù –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –≤ Phantom‚Ä¶");
    // 2) –û—Ç–ø—Ä–∞–≤–∫–∞ + –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –ª–æ–≥–∞–º–∏
    const sig = await sendViaPhantom(tx, { blockhash, lastValidBlockHeight });
    logOk("‚úÖ –ì–æ—Ç–æ–≤–æ! tx:", sig);
    log("üîó Explorer:", `https://explorer.solana.com/tx/${sig}?cluster=devnet`);
} catch (e) {
    // –ü–µ—á–∞—Ç–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ
    printRpcError("‚ùå –û—à–∏–±–∫–∞ init:", e);
}
});

// ===== DELETE INIT =====
document.getElementById("btn-delete-init").addEventListener("click", async () => {
    try {
        // 1) –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        if (!walletPubkey) throw new Error("–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏ Phantom.");

        // 2) PDA ‚Äî —Ç–µ –∂–µ —Å–∏–¥—ã, —á—Ç–æ –∏ –≤ init
        const statePda = await getStatePda();
        log("üóëÔ∏è –í—ã–∑—ã–≤–∞–µ–º delete_init()");
        log("   signer:   ", walletPubkey.toBase58());
        log("   statePda: ", statePda.toBase58());
        log("   programId:", PROGRAM_ID.toBase58());

        // 3) –î–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–æ—Ä Anchor –¥–ª—è "global:delete_init"
        const data = await anchorDiscriminator8("delete_init"); // 8 –±–∞–π—Ç

        // 4) –ê–∫–∫–∞—É–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç on-chain –º–µ—Ç–æ–¥
        const keys = [
            { pubkey: walletPubkey,                         isSigner: true,  isWritable: true  }, // signer (–ø–æ–ª—É—á–∞—Ç–µ–ª—å —Ä–µ–Ω—Ç—ã)
            { pubkey: statePda,                             isSigner: false, isWritable: true  }, // state_pda
            { pubkey: solanaWeb3.SystemProgram.programId,   isSigner: false, isWritable: false },
        ];

        const ix = new solanaWeb3.TransactionInstruction({
            programId: PROGRAM_ID,
            keys,
            data, // —Ç–æ–ª—å–∫–æ 8 –±–∞–π—Ç –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–æ—Ä–∞, —Ç.–∫. —É –º–µ—Ç–æ–¥–∞ –Ω–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
        });

        // 5) –ë–ª–æ–∫—Ö–µ—à, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
        const { value: ctx } = await connection.getLatestBlockhashAndContext("processed");
        const { blockhash, lastValidBlockHeight } = ctx;
        log("‚è± blockhash:", blockhash);
        log("‚è± lastValidBlockHeight:", lastValidBlockHeight);

        const tx = new solanaWeb3.Transaction({
            feePayer: walletPubkey,
            recentBlockhash: blockhash,
        }).add(ix);

        // 6) –°–∏–º—É–ª—è—Ü–∏—è ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        await simulateAndLog(tx);

        log("üìù –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º –≤ Phantom‚Ä¶");
        const sig = await sendViaPhantom(tx, { blockhash, lastValidBlockHeight });

        logOk("‚úÖ delete_init –≤—ã–ø–æ–ª–Ω–µ–Ω. tx:", sig);
        log("üîó Explorer:", `https://explorer.solana.com/tx/${sig}?cluster=devnet`);
        alert(`PDA —É–¥–∞–ª—ë–Ω, —Ä–µ–Ω—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∞–Ω—Ç—É.\nTx: ${sig}`);
    } catch (e) {
        printRpcError("‚ùå –û—à–∏–±–∫–∞ delete_init:", e);
        alert(`–û—à–∏–±–∫–∞ delete_init: ${e.message || e}`);
    }
});

    // –ë–æ–ª—å—à–µ –ù–ò–ö–ê–ö–ò–• –∞–≤—Ç–æ–∫–æ–Ω–Ω–µ–∫—Ç–æ–≤ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
        if (window.solana?.isPhantom) {
            provider = window.solana;
            log("‚ÑπÔ∏è Phantom –Ω–∞–π–¥–µ–Ω. –ù–∞–∂–º–∏ ¬´Connect Phantom¬ª, —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è.");
        } else {
            log("‚ÑπÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∏ Phantom Wallet: https://phantom.app");
        }
    }


)();

</script>
</body>
</html>
